<?php
	$MAX_TEAMS = 6;

	require_once "config/db.php";

	db_connect();

	$r = db_query("SELECT COUNT(*) AS team_count FROM teams WHERE enabled='Y';");
	$num_teams = mysql_result($r, 0, "team_count");

	$num_rows = 5;
	$num_columns = 5;
?>

<html>
	<head>
		<title>2013 Cyber Storm Challenge Portal</title>
		<script type="text/javascript" src="../jquery-1.9.1.min.js"></script>
		<script type="text/javascript" src="../raphael-min.js"></script>
		<script type="text/javascript" src="challenges.js"></script>
		<script type="text/javascript" src="jquery.tipTip.js"></script>
		<script type="text/javascript" src="kinetic.js"></script>
		<link rel="stylesheet" type="text/css" href="challenges.css" />
		<link rel="stylesheet" type="text/css" href="tipTip.css" />
	</head>

	<body >
		<div id="info" ></div>
		<div id="container" >
    <script defer="defer">

var descList = new Array();
      function writeMessage(messageLayer, message) {
        var context = messageLayer.getContext();
        messageLayer.clear();
        context.font = '18pt Calibri';
        context.fillStyle = 'white';
        context.fillText(descList[message.targetNode.id], 10, 25);
      }
      var stage = new Kinetic.Stage({
        container: 'container',
        width: 1024,
        height: 200
      });
	var shapesLayer = new Kinetic.Layer();
	var messageLayer = new Kinetic.Layer();
	var layer = new Kinetic.Layer();

	var imageObj = new Image();
	imageObj.onload = function() {
		pullChallenges();

      };


function pullChallenges(){
new_nodes = [];

// fetch the nodes from the DB
$.ajax(
{
	url: "get_challenges.php",
	type: "POST",
	success: function(data)
	{

		if (data == "")
			return;

		var fetched_nodes = data.split("||");

		// grab team nodes
		for (var j=0; j<fetched_nodes.length; j++)
		{
			var c_id = fetched_nodes[j].split("|-")[0];
			var c_name = fetched_nodes[j].split("|-")[1];
			var c_desc = fetched_nodes[j].split("|-")[2];
			var c_points = fetched_nodes[j].split("|-")[3];
			var c_timeStart = fetched_nodes[j].split("|-")[4];
			var c_winner = fetched_nodes[j].split("|-")[5];

			var y = 30;
			var yoda = new Kinetic.Image({
				x: 40+(j*120),
				y: stage.getHeight() / 2 - 59,
				image: imageObj,
				width: 100,
				height: 100,
				stroke: 'white',
				strokeWidth:3,
				strokeEnabled: true
			});
			var desc = new String(c_name + " : " +c_desc + " FOR "+c_points + " points. Winner = " + c_winner);
			descList[j]=desc;
			yoda.id=j;
			yoda.on('mousemove', function(j) { //passes a mouse event. we use target node to detect which description to display
				writeMessage(messageLayer, j);
			});
			layer.add(yoda);
		}
		stage.add(layer);
	}
});	

	stage.add(layer);
}


imageObj.src = 'http://i.imgur.com/QoEEqjh.png';




      stage.add(messageLayer);
    </script>
		</div>

		<div id="bottom"></div>
	</body>
</html>

